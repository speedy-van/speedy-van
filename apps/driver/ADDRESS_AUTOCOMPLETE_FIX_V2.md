# ๐ง ุฅุตูุงุญุงุช ูุธุงู ุงูุชุฑุงุญ ุงูุนูุงููู - ุงูุฅุตุฏุงุฑ 2

## ุงููุดููุฉ ุงูุฃุตููุฉ

ุนูุฏ ุงุฎุชูุงุฑ ุนููุงู ูู ุงูุงูุชุฑุงุญุงุชุ ูุงูุช ุงูุญููู ูุง ุชููุฃ ุจุดูู ุตุญูุญ ููุธูุฑ ููุท ุงูุฑูู ูุงูุญุฑู ุงูุฃูู ูู ุงูุนููุงู.

## ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ ูู ุงูุฅุตุฏุงุฑ 2

### 1. ุฅุตูุงุญ ุชุถุงุฑุจ ุงูุจูุงูุงุช ุจูู API ู Component

**ุงููุดููุฉ:** ูุงู ููุงู ุชุถุงุฑุจ ูู ููููุฉ ูุนุงูุฌุฉ ุงูุจูุงูุงุช ุจูู API endpoint ู `normalizeSuggestions`.

**ุงูุญู:**

- ุชุญุฏูุซ `normalizeSuggestions` ููุชุนุงูู ูุน ุงูุจูุงูุงุช ุงูููุนุงูุฌุฉ ูู API
- ุฅุถุงูุฉ fallback ููุจูุงูุงุช ุงูุฎุงู ูู Mapbox
- ุชุญุณูู ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ูู `place_name`

```typescript
// API ูุนูุฏ ุงูุจูุงูุงุช ุงูููุนุงูุฌุฉ
if (Array.isArray(data)) {
  return data.map((item: any) => ({
    id: item.id,
    label: item.label,
    address: {
      line1: item.address?.line1 || item.label.split(',')[0] || item.label,
      city: item.address?.city || '',
      postcode: item.address?.postcode || '',
    },
    coords: item.coords,
  }));
}
```

### 2. ุชุญุณูู ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ูู API

**ุงููุดููุฉ:** ุงูุจูุงูุงุช ูู Mapbox ูู ุชูู ุชูุณุชุฎุฑุฌ ุจุดูู ุตุญูุญ.

**ุงูุญู:**

- ุชุญุณูู ุฏุงูุฉ `mapboxFeatureToAddress`
- ุฅุถุงูุฉ fallback ูุชุนุฏุฏ ุงููุณุชููุงุช ููู `line1`
- ุชุญุณูู ุงุณุชุฎุฑุงุฌ ุงููุฏููุฉ ูุงูุฑูุฒ ุงูุจุฑูุฏู

```typescript
// ุชุญุณูู ุงุณุชุฎุฑุงุฌ line1
let line1 = [number, street].filter(Boolean).join(' ').trim();

// Fallback 1: ุงุณุชุฎุฑุงุฌ ูู place_name
if (!line1 || line1.length < 3) {
  const parts = f?.place_name?.split(',') || [];
  if (parts.length > 0) {
    line1 = parts[0].trim();
  }
}

// Fallback 2: ุงุณุชุฎุฏุงู place_name ูุงููุงู
if (!line1 || line1.length < 3) {
  line1 = f?.place_name || '';
}
```

### 3. ุชุญุณูู ูุนุงูุฌุฉ ุงูุจูุงูุงุช ูู AddressForm

**ุงููุดููุฉ:** ุงูุจูุงูุงุช ูู ุชูู ุชูุณุชุฎุฑุฌ ุจุดูู ุฐูู ูู ุงูุนููุงู ุงููุงูู.

**ุงูุญู:**

- ุฅุถุงูุฉ ุงุณุชุฎุฑุงุฌ ุฐูู ูููุฏููุฉ ูุงูุฑูุฒ ุงูุจุฑูุฏู
- ุชุญุณูู fallback ููุจูุงูุงุช ุงูููููุฏุฉ
- ุฅุถุงูุฉ ูุญุต ููุจูุงูุงุช ุงููุตูุฑุฉ

```typescript
// ุงุณุชุฎุฑุงุฌ ุฐูู ูููุฏููุฉ ูุงูุฑูุฒ ุงูุจุฑูุฏู
if (!city || !postcode) {
  const parts = sel.label.split(',');
  if (parts.length > 1) {
    // ุขุฎุฑ ุฌุฒุก ุนุงุฏุฉู ูู ุงูุฑูุฒ ุงูุจุฑูุฏู
    postcode = postcode || parts[parts.length - 1].trim();
    // ุงูุฃุฌุฒุงุก ุงููุณุทู ุนุงุฏุฉู ูู ุงููุฏููุฉ
    city = city || parts.slice(1, -1).join(',').trim();
  }
}
```

### 4. ุฅุถุงูุฉ Debugging ุดุงูู

**ุงููุดููุฉ:** ูุงู ูู ุงูุตุนุจ ุชุชุจุน ุงููุดููุฉ ุจุฏูู logging.

**ุงูุญู:**

- ุฅุถุงูุฉ logging ูู API endpoint
- ุฅุถุงูุฉ logging ูู AddressAutocomplete
- ุฅุถุงูุฉ logging ูู AddressForm
- ุฅูุดุงุก ุตูุญุฉ ุงุฎุชุจุงุฑ ููู API

### 5. ุฅูุดุงุก ุตูุญุฉ ุงุฎุชุจุงุฑ

ุชู ุฅูุดุงุก `test-api.html` ูุงุฎุชุจุงุฑ API endpoint ูุจุงุดุฑุฉู.

## ููููุฉ ุงูุงุฎุชุจุงุฑ

### 1. ุงุฎุชุจุงุฑ API ูุจุงุดุฑุฉู:

1. ุงูุชุญ `http://localhost:3000/test-api.html`
2. ุงูุชุจ ุนููุงู ูู ุญูู ุงูุจุญุซ
3. ุชุญูู ูู ุงูุจูุงูุงุช ุงูููุฑุฌุนุฉ ูู Console

### 2. ุงุฎุชุจุงุฑ ุงูุชุทุจูู:

1. ุงูุชุจ ุนููุงู ูู ุญูู ุงูุจุญุซ
2. ุงุฎุชุฑ ุนููุงู ูู ุงูุงูุชุฑุงุญุงุช
3. ุชุญูู ูู Console ูุฑุคูุฉ ุงูุจูุงูุงุช ูู ูู ูุฑุญูุฉ
4. ุชุญูู ูู ุฃู ุฌููุน ุงูุญููู ุชู ููุคูุง ุจุดูู ุตุญูุญ

### 3. ูุฑุงูุจุฉ Console:

ุงุจุญุซ ุนู ุงูุฑุณุงุฆู ุงูุชุงููุฉ ูู Console:

- `[PLACES] Raw Mapbox response:`
- `[PLACES] Processed suggestions:`
- `[AddressAutocomplete] API response:`
- `[AddressAutocomplete] Normalized items:`
- `[AddressAutocomplete] Selected item:`
- `[AddressForm] Setting pickup data:`
- `[AddressForm] Setting dropoff data:`

## ุงููุชุงุฆุฌ ุงููุชููุนุฉ

ุจุนุฏ ุชุทุจูู ูุฐู ุงูุฅุตูุงุญุงุช:

1. โ **ููุก ุตุญูุญ ููุญููู:** ุฌููุน ุงูุญููู ุณุชูููุฃ ุจุดูู ุตุญูุญ
2. โ **ุงุณุชุฎุฑุงุฌ ุฐูู ููุจูุงูุงุช:** ุงููุธุงู ุณูููู ุจุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ูู ุงูุนููุงู ุงููุงูู
3. โ **fallback ูุชุนุฏุฏ ุงููุณุชููุงุช:** ุญุชู ูู ูุงูุช ุงูุจูุงูุงุช ููููุฏุฉุ ุณูุชู ุงุณุชุฎุฑุงุฌูุง
4. โ **debugging ุดุงูู:** ูููู ุชุชุจุน ุงููุดุงูู ุจุณูููุฉ
5. โ **ุงุฎุชุจุงุฑ ูุจุงุดุฑ:** ูููู ุงุฎุชุจุงุฑ API ุจุดูู ูููุตู

## ุงููููุงุช ุงููุนุฏูุฉ

- `apps/web/src/components/AddressAutocomplete.tsx`
- `apps/web/src/app/api/places/suggest/route.ts`
- `apps/web/src/components/AddressForm.tsx`
- `apps/web/test-api.html` (ุฌุฏูุฏ)

## ููุงุญุธุงุช ุฅุถุงููุฉ

- ุชู ุฅุถุงูุฉ logging ุดุงูู ูุชุชุจุน ุงููุดุงูู
- ุชู ุฅูุดุงุก ุตูุญุฉ ุงุฎุชุจุงุฑ ูููุตูุฉ
- ุงูุฅุตูุงุญุงุช ุชุญุงูุธ ุนูู ุงูุชูุงูู ูุน ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ
- ุชู ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูุงูุจูุงูุงุช ุงูููููุฏุฉ
- ุงููุธุงู ูุฏุนู ุงูุขู ุงูุจูุงูุงุช ูู Mapbox ุจุดูู ุฃูุถู
