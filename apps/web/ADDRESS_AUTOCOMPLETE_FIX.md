# ๐ง ุฅุตูุงุญุงุช ูุธุงู ุงูุชุฑุงุญ ุงูุนูุงููู - Address Autocomplete Fixes

## ุงููุดููุฉ ุงูุฃุตููุฉ

ุนูุฏ ุงุฎุชูุงุฑ ุนููุงู ูู ุงูุงูุชุฑุงุญุงุชุ ูุงูุช ุงูุญููู ูุง ุชููุฃ ุจุดูู ุตุญูุญ ููุธูุฑ ููุท ุงูุฑูู ูุงูุญุฑู ุงูุฃูู ูู ุงูุนููุงู.

## ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ

### 1. ุฅุตูุงุญ ุฏุงูุฉ `normalizeSuggestions` ูู `AddressAutocomplete.tsx`

**ุงููุดููุฉ:** ุงูุฏุงูุฉ ูู ุชูู ุชุณุชุฎุฑุฌ ุงูุจูุงูุงุช ูู ุงุณุชุฌุงุจุฉ Mapbox ุจุดูู ุตุญูุญ.

**ุงูุญู:**

- ุชุญุณูู ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ูู `context` array
- ุฅุถุงูุฉ ุฏุนู ูู `properties` object
- ุชุญุณูู ุงุณุชุฎุฑุงุฌ ุฑูู ุงูุดุงุฑุน ูุงุณู ุงูุดุงุฑุน
- ุฅุถุงูุฉ fallback ููุจูุงูุงุช ุงูููููุฏุฉ

```typescript
// ูุจู ุงูุฅุตูุงุญ
const line1 = label.split(',')[0] ?? label;

// ุจุนุฏ ุงูุฅุตูุงุญ
const number = f?.address || '';
const street = f?.text || '';
const line1 =
  [number, street].filter(Boolean).join(' ').trim() ||
  label.split(',')[0] ||
  label;
```

### 2. ุฅุตูุงุญ API Endpoint ูู `route.ts`

**ุงููุดููุฉ:** API ูุงู ูุนูุฏ ุงูุจูุงูุงุช ูู object ุจุฏูุงู ูู array ูุจุงุดุฑุฉ.

**ุงูุญู:**

```typescript
// ูุจู ุงูุฅุตูุงุญ
return NextResponse.json(
  { suggestions },
  { status: 200, headers: softCache() }
);

// ุจุนุฏ ุงูุฅุตูุงุญ
return NextResponse.json(suggestions, { status: 200, headers: softCache() });
```

### 3. ุชุญุณูู ุฏุงูุฉ `selectItem` ูู `AddressAutocomplete.tsx`

**ุงููุดููุฉ:** ูู ุชูู ุชุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช ูุจู ุฅุฑุณุงููุง.

**ุงูุญู:**

- ุฅุถุงูุฉ ูุญุต ููุจูุงูุงุช ุงูููููุฏุฉ
- ุฅุถุงูุฉ fallback ููุนูุงููู ุงููุตูุฑุฉ
- ุชุญุณูู ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ูู label

### 4. ุชุญุณูู ูุนุงูุฌุฉ ุงูุจูุงูุงุช ูู `AddressForm.tsx`

**ุงููุดููุฉ:** ูู ุชูู ุชุชุนุงูู ูุน ุงูุจูุงูุงุช ุงูููููุฏุฉ ุจุดูู ุตุญูุญ.

**ุงูุญู:**

- ุฅุถุงูุฉ ูุนุงูุฌุฉ ุฐููุฉ ููุจูุงูุงุช
- ุงุณุชุฎุฑุงุฌ ุงููุฏููุฉ ูุงูุฑูุฒ ุงูุจุฑูุฏู ูู ุงูุนููุงู ุงููุงูู
- ุฅุถุงูุฉ fallback ููุจูุงูุงุช ุงูููููุฏุฉ

```typescript
const line1 = sel.address.line1 || sel.label.split(',')[0] || sel.label;
const city =
  sel.address.city || sel.label.split(',').slice(1, -1).join(',').trim() || '';
const postcode =
  sel.address.postcode || sel.label.split(',').pop()?.trim() || '';
```

### 5. ุชุญุณูู ุนุฑุถ ุงูุงูุชุฑุงุญุงุช

**ุงููุดููุฉ:** ูู ุชูู ุชุธูุฑ ุชูุงุตูู ุงูุนููุงู ุจุดูู ูุงุถุญ.

**ุงูุญู:**

- ุฅุถุงูุฉ ุนุฑุถ ุฅุถุงูู ููุนููุงู ุงููุญุฏุฏ
- ุชุญุณูู ุงูุชูุณูู ุงูุจุตุฑู
- ุฅุถุงูุฉ ุฃููููุฉ ููุนููุงู ุงููุญุฏุฏ

## ุงููุชุงุฆุฌ ุงููุชููุนุฉ

ุจุนุฏ ุชุทุจูู ูุฐู ุงูุฅุตูุงุญุงุช:

1. โ **ููุก ุตุญูุญ ููุญููู:** ุฌููุน ุงูุญููู (ุงูุนููุงูุ ุงููุฏููุฉุ ุงูุฑูุฒ ุงูุจุฑูุฏู) ุณุชูููุฃ ุจุดูู ุตุญูุญ
2. โ **ุงุณุชุฎุฑุงุฌ ุฐูู ููุจูุงูุงุช:** ุงููุธุงู ุณูููู ุจุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ูู ุงูุนููุงู ุงููุงูู
3. โ **fallback ููุจูุงูุงุช ุงูููููุฏุฉ:** ุญุชู ูู ูุงูุช ุจุนุถ ุงูุจูุงูุงุช ููููุฏุฉุ ุณูุชู ุงุณุชุฎุฑุงุฌูุง ูู ุงูุนููุงู
4. โ **ุนุฑุถ ูุญุณู:** ุงูุงูุชุฑุงุญุงุช ุณุชุธูุฑ ุจุชูุงุตูู ุฃูุถุญ
5. โ **ุงุณุชูุฑุงุฑ ุฃูุถู:** ุงููุธุงู ุณูููู ุฃูุซุฑ ุงุณุชูุฑุงุฑุงู ูุน ุงูุจูุงูุงุช ุงููุฎุชููุฉ

## ููููุฉ ุงูุงุฎุชุจุงุฑ

1. ุงูุชุจ ุนููุงู ูู ุญูู ุงูุจุญุซ
2. ุงุฎุชุฑ ุนููุงู ูู ุงูุงูุชุฑุงุญุงุช
3. ุชุญูู ูู ุฃู ุฌููุน ุงูุญููู ุชู ููุคูุง ุจุดูู ุตุญูุญ:
   - Address Line 1
   - City
   - Postcode
4. ุชุญูู ูู ุฃู ุงูุจูุงูุงุช ุตุญูุญุฉ ูููุชููุฉ

## ุงููููุงุช ุงููุนุฏูุฉ

- `apps/web/src/components/AddressAutocomplete.tsx`
- `apps/web/src/app/api/places/suggest/route.ts`
- `apps/web/src/components/AddressForm.tsx`

## ููุงุญุธุงุช ุฅุถุงููุฉ

- ุงูุฅุตูุงุญุงุช ุชุญุงูุธ ุนูู ุงูุชูุงูู ูุน ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ
- ุชู ุฅุถุงูุฉ ุชุนูููุงุช ุชูุถูุญูุฉ ููููุฏ
- ุงููุธุงู ูุฏุนู ุงูุขู ุงูุจูุงูุงุช ูู Mapbox ุจุดูู ุฃูุถู
- ุชู ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูุงูุจูุงูุงุช ุงูููููุฏุฉ
